<html>
<head>

<title>iframr</title>

<style>
body {
    font-family: Verdana, sans-serif;
    margin: 0;
    padding: 0;
}

.header { width: 100%; }

.frame { width: 50%; height: 100%; }
iframe {
    width: 100%;
    height: 100%;
    overflow: auto;
    position: relative;
}

input, span { margin: 1em; }
input[type="text"] { width: 50%; }

.xfactor {
    text-align: center;
    width: 421px;
    height: 109px;
    padding: 27px 0 0 0;
    background: transparent url(xfactor_bg.png) no-repeat top left;
    font-size: 36px;
    text-decoration: shadow;
    position: absolute;
    top: 40%;
    left: 50%;
    margin-left: -211px;
    z-index: 10;
}
.good {
    color: #C1D82F;
    font-weight: bold;
}
</style>

<link type="text/css" href="css/smoothness/jquery-ui-1.8.custom.css" rel="stylesheet" />  
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.custom.min.js"></script>
<script type="text/javascript" src="jquery.url.js"></script>

<script>

var start = [new Date(), new Date()];
var duration = [0, 0];
var runs = new Array();

if(!String.prototype.startsWith){
    String.prototype.startsWith = function (str) {
        return !this.indexOf(str);
    }
}

load_frame = function(i, j) {

    // Add http method if it is not there
    var url = $('#url'+i).val();
    if (!url.startsWith('http://')) {
        url = 'http://' + url;
        $('#url'+i).val(url);
    }

    // Clear current frame
    $('#frame'+i).attr('src', 'about:blank');	

    // Starting timestamp
    start[i] = new Date();
    duration[i] = 0; 

    // Set frame address to whatever's in the input box
    $('#frame' + i).attr('src', url);

    // Update loading message
    $('#time' + i).html('<blink>loading...</blink>');

    // Clear xfactor box
    $('#x' + i).html('');
    $('#x' + j).html('');
};

display_runs = function() {
    var msg = '<ul>';
    $.each(runs, function(key, value) {
        msg += '<li>' + String(key);
        msg += '<ul>';
        $.each(value, function(key, value) {
            msg += '<li>' + String(value) + '</li>';
            alert('blah');
        });
        msg += '</ul>';
        msg += '</li>';
    });
    msg += '</ul>';
    $('#header').text(msg);
}
after_load = function(i, j) {

    // Grab the ending timestamp
    var end = new Date();

    // Display load time
    var dur = end.getTime() - start[i].getTime();
    duration[i] = dur;
    $('#time' + i).text(dur + ' ms');

    // Calculate benefit
    if (duration[i] && duration[j]) {
        /*
        if (duration[i] < duration[j]) {
            var benefit = duration[j]/duration[i];
            $('#x' + i).html('<div class="xfactor">' + + benefit.toFixed(2) + ' &times; faster &rarr;</div>');
            $('#x' + j).html('');
        }
        else {
        */
            var benefit = duration[i]/duration[j];
            if (i === 0) {
                $('#x' + j).html('<div class="xfactor">' + + benefit.toFixed(2) + ' &times; faster &rarr;</div>');
            } else {
                $('#x' + j).html('<div class="xfactor">&larr; ' + + benefit.toFixed(2) + ' &times; faster</div>');
            }
            $('#x' + i).html('');

            /*
            // Record result
            var pair = $('#url'+i).val() + ':' + $('#url'+j).val();
            if (!runs[pair])
                runs[pair] = new Array();

            runs[pair].push([duration[i], duration[j], benefit]);
            display_runs();
            */
        //}
    }

};

reload_frames = function () {
    load_frame(1, 0);
    load_frame(0, 1);
};

$(window).ready(function(){
    $('#url0').focus();

    $('#frame0').load(function() { after_load(0, 1); });
    $('#frame1').load(function() { after_load(1, 0); });

    $('#go').click(reload_frames);
    $('#url0, #url1').keyup(function (e) {
        if (e.keyCode == 13) {reload_frames();}
    });


    $("#multiple-form").dialog({
        autoOpen: false, height: 300, width: 350, modal: true,
        buttons: {
            'Go': function() {
                var bValid = true;
                if (bValid) {
                    $(this).dialog('close');
                }
            },
            'Cancel': function() {
                $(this).dialog('close');
            }
        },
        close: function() {
        }
    });

    $('#go').button();
    $('#repeat').button();
    $('#multiple').button().click(function () { $('#multiple-form').dialog('open'); });
});
</script>

</head>
<body>

<div id="header" style="width:100%;">
</div>

<div id="multiple-form" style="display:none;">
    <p>Multiple pages</p>
    <table>
    <tr>
        <td><input type="text" id="url0-0" class="text ui-widget-content ui-corner-all" /></td>
        <td><input type="text" id="url0-1" class="text ui-widget-content ui-corner-all" /></td>
    </tr>
    <tr>
        <td><input type="text" id="url1-0" class="text ui-widget-content ui-corner-all" /></td>
        <td><input type="text" id="url1-1" class="text ui-widget-content ui-corner-all" /></td>
    </tr>
    </table>
</div>

<div class="frame" id="div0" style="float:left">

    <label for="url0">URL:</label>
    <input id="url0" type="text" class="text ui-widget-content ui-corner-all" value="google.com" tabindex=1 />
    <span id="time0"></span>

    <span id="x0" class="good"></span>
    <iframe id="frame0">one</iframe>

</div>

<div class="frame" id="div1" style="float:right">

    <label for="url1">URL:</label>
    <input id="url1" type="text" class="text ui-widget-content ui-corner-all" value="bing.com" tabindex=2 />
    <span id="time1"></span>
    <button id="go" tabindex=3 >GO</button>
    <button id="repeat" tabindex=4 >Repeat</button>
    <button id="multiple" tabindex=5 >Multiple</button>

    <span id="x1" class="good"></span>
    <iframe id="frame1">two</iframe>

</div>


</body>
</html>
